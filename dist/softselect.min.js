!function(){"use strict";angular.module("softselect.directive",[]).directive("softselect",function(e,s,l,n,t){return{restrict:"E",replace:!0,scope:{ssData:"=",ssModel:"=",ssField:"=",ssMany:"<?",ssChange:"=",ssTabindex:"=tabindex",ssDisabled:"="},templateUrl:"softselect.html",link:function(s,r,i){function o(){if(angular.forEach(s.orderedData,function(e){e.selected=!1}),s.ssMany)s.ssModel.length===s.orderedData.length?s.allSelected=!0:(s.allSelected=!1,angular.forEach(s.ssModel,function(e){var l=s.orderedData.findIndex(function(l){return l[s.ssField.value]===e[s.ssField.value]});l>-1&&(s.orderedData[l].selected=!0)}));else{if(angular.isUndefined(s.ssModel)&&null!==s.ssModel)return;var e=s.orderedData.filter(function(e){return null!==e&&null!==s.ssModel&&e[s.ssField.value]===s.ssModel[s.ssField.value]});e&&(e.selected=!0),angular.isDefined(s.ssModel)&&angular.isDefined(s.ssField)&&null!==s.ssModel&&(s.ssFilter=s.ssModel[s.ssField.text])}}function d(){angular.element(s.dropdownList).empty(),s.filteredData=s.orderedData,s.ssFilter&&(s.filteredData=e("filter")(s.orderedData,s.ssFilter,a)),s.filteredData=e("limitTo")(s.filteredData,s.selectLimit),angular.forEach(s.filteredData,function(e){var l=function(e){return s.ssMany?s.ssModel.some(function(l){return l[s.ssField.value]===e[s.ssField.value]}):!angular.isUndefined(s.ssModel)&&!angular.isUndefined(s.ssField)&&null!==s.ssModel&&null!==s.ssField&&s.ssModel[s.ssField.text]===e[s.ssField.text]}(e)||s.allSelected?"<span class='fa fa-check'></span>":"",n="<li class='item' ng-click='ss_select("+e[s.ssField.value]+")'>"+e[s.ssField.text]+l+"</li>";angular.element(s.dropdownList).append(t(n)(s))})}function a(e,l){if("object"==typeof e&&null!==e&&!angular.isUndefined(e[s.ssField.text])&&null!==e[s.ssField.text])return e=c(e[s.ssField.text]),l=c(l),e.indexOf(l)>-1}function c(e){var s={a:/[\xE0-\xE6]/g,e:/[\xE8-\xEB]/g,i:/[\xEC-\xEF]/g,o:/[\xF2-\xF6]/g,u:/[\xF9-\xFC]/g,c:/\xE7/g,n:/\xF1/g},l=[["Á","A"],["À","A"],["Â","A"],["Ã","A"],["É","E"],["È","E"],["Ê","E"],["Í","I"],["Ì","I"],["Î","I"],["Ó","O"],["Ò","O"],["Ô","O"],["Õ","O"],["Ú","U"],["Ù","U"],["Û","U"]];for(var n in s){var t=s[n];e=e.replace(t,n)}var r;for(r=0;r<l.length;r++)e=e.replace(l[r][0],l[r][1]);return e.toUpperCase()}var u=0;s.ssFilter="",s.selectLimit=10,s.ssMany=s.$eval(i.ssMany)||!1,s.lastSelected={},s.isOpen=!1,s.filteredData=[],s.scrollParent=null,s.first=!0,s.orderedData=[],s.getFilteredData=d,s.ss_selectAll=function(){s.ssModel=s.orderedData,event.stopPropagation(),d()},s.ss_clearAll=function(e){s.ssMany?s.ssModel=[]:s.ssModel={},s.selectedText="",angular.isDefined(e)&&(s.isOpen=!1,s.selecting=!1,e.stopPropagation()),d()},s.dropdown=null,s.dropdownMenu=null,s.dropTop=0,s.dropLeft=0,s.dropWidth=0,s.dropHeight=0,s.inputFilter=null,s.scrollParent=null,s.open=function(e){s.first&&(s.dropdown=e.currentTarget,s.dropdownMenu=s.dropdown.querySelector(".softdown-menu"),s.scrollParent=function(e,s){for(var l=getComputedStyle(e),t="absolute"===l.position,r=s?/(auto|scroll|hidden)/:/(auto|scroll)/,i=e;i=i.parentElement;)if(l=getComputedStyle(i),(!t||"static"!==l.position)&&r.test(l.overflow+l.overflowY+l.overflowX))return i;return n}(s.dropdown,!0),s.dropdownList=s.dropdownMenu.querySelector(".softdown-list"),angular.element(s.scrollParent).bind("scroll",function(){s.isOpen&&(s.dropTopFixed=s.dropTop-this.scrollTop,s.$apply())}),$(".softselect .softdown .softdown-menu").scroll(function(){var e=$(this).scrollTop(),l=$(this).prop("scrollHeight")-$(this).outerHeight();l!=u&&e>=l&&s.selectLimit<s.orderedData.length&&(s.$apply(function(){s.selectLimit=s.selectLimit+10,d()}),l!=u&&(l=u))}),s.ssMany?s.inputFilter=s.dropdown.querySelector(".filter"):s.inputFilter=s.dropdown.querySelector(".form-control"),s.first=!1),s.ssMany?angular.isUndefined(s.ssModel)&&(s.ssModel=[]):angular.isUndefined(s.ssModel)&&(s.ssModel={}),function(e,l){var n=$(window).height(),t=$(window).scrollTop(),r=$(e).offset().top,i=$(e).offset().left,o=$(e).height(),d=$(e).width(),a=$(l).height()<0?150:$(l).height(),c=r+o-t;c+a>n&&(c-=o+a),s.dropTopFixed=s.dropTop=c-4,s.dropLeftFixed=s.dropLeft=i+2,s.dropWidthFixed=s.dropWidth=d-2}(s.dropdown,s.dropdownMenu),s.isOpen?s.isOpen&&!1===s.ssMany&&(s.isOpen=!1,s.ssFilter=s.ssModel[s.ssField.text]):(s.isOpen=!0,s.ssFilter="",d()),!1===s.ssMany&&angular.isDefined(s.ssModel)&&angular.isDefined(s.ssField)&&!s.ssModel[s.ssField.text]||s.inputFilter.focus()},s.$watch("ssModel",function(){o(),angular.isDefined(s.ssChange)&&(angular.equals(s.ssModel,{})?s.ssChange(!1):s.ssChange(s.ssModel))}),s.$watch("ssData",function(){angular.isDefined(s.ssData)&&(s.orderedData=e("orderBy")(s.ssData,s.ssField.orderby),o(),d())}),s.$watch("ssFilter",function(){angular.isDefined(s.ssFilter)&&d()}),s.ss_select=function(e){var l=s.orderedData.filter(function(l){return l[s.ssField.value]===e})[0];s.ssMany?(s.ssModel.some(function(l){return l[s.ssField.value]===e})?s.ssModel=s.ssModel.filter(function(l){return l[s.ssField.value]!==e}):s.ssModel.push(l),angular.isDefined(s.ssChange)&&s.ssChange(s.ssModel)):s.ssModel[s.ssField.value]===e?s.ssModel={}:s.ssModel=l,d(),s.ssMany?(s.ssFilter="",s.inputFilter.focus()):s.isOpen=!1};var f=function(e){s.isOpen&&(r[0].contains(e.target)||s.$apply(function(){s.isOpen=!1,angular.isDefined(s.ssModel)&&angular.isDefined(s.ssField)&&angular.isDefined(s.ssFilter)&&s.ssModel[s.ssField.text]!==s.ssFilter&&(s.ssFilter=s.ssModel[s.ssField.text]),!0===s.ssMany&&(s.ssFilter="")}))};l.on("click",f),s.$on("$destroy",function(){l.off("click",f)})}}})}(),angular.module("softselect.directive").run(["$templateCache",function(e){e.put("softselect.html",'\r\n<div class="softselect" ng-class="{\'disabled\': ssDisabled}">\r\n\r\n    <div class="softdown" ng-click="open($event)" ng-keypress="$event.stopPropagation()">\r\n\r\n        <div tabindex="{{ssTabindex}}"  class="selected-box" placeholder="" aria-describedby="basic-addon2" >\r\n\r\n                <div class="full-h" ng-hide="ssMany">\r\n\r\n                    <div class="form-group has-feedback">\r\n\r\n                        <input class="form-control" style="padding-left: 7px !important;" ng-model="ssFilter" placeholder="Selecionar...">\r\n\r\n                        <span class="fa fa-caret-down form-control-feedback" ng-hide="ssModel[ssField.value]" aria-hidden="true"></span>\r\n\r\n                    </div>\r\n\r\n                </div>\r\n\r\n                <div class="full-h" ng-show="ssMany">\r\n\r\n                    <div class="form-group has-feedback">\r\n\r\n                        <div class="form-control">\r\n\r\n                        <ul style="margin-left: {{ssModel.length > 0 ? \'2px\' : \'7px\'}}">\r\n\r\n                            <li ng-show="ssModel.length > 2" class="selected-item" style="max-width: 100px;" ng-click="ss_clearAll($event)">\r\n\r\n                               <span class="fa fa-times"></span> {{ssModel.length === orderedData.length ? "Todos" : ssModel.length}} selecionados\r\n\r\n                            </li>\r\n\r\n                            <li ng-show="ssModel.length > 0 && ssModel.length <= 2" class="selected-item" ng-repeat="item in ssModel | limitTo: 2 track by $index" ng-click="ss_select(item[ssField.value])">\r\n\r\n                                <span class="fa fa-times"></span> {{item[ssField.text]}}\r\n\r\n                            </li>\r\n\r\n                            <li class="selected-input" style="margin-left: 2px; max-width: {{ssModel.length > 0 ? \'10px\' : \'100%\'}}">\r\n\r\n                                <input class="filter" ng-model="ssFilter" placeholder="{{ssModel.length > 0 ? \'\' : \'Selecionar...\'}}">\r\n\r\n                            </li>&nbsp;\r\n\r\n                        </ul>\r\n\r\n                    </div>\r\n\r\n                    </div>\r\n\r\n                </div>\r\n\r\n        </div>\r\n\r\n        <span class="fa fa-times selected-clear" style="cursor:pointer" ng-show="ssModel[ssField.value]" ng-click="ss_clearAll($event)" title="Limpar"></span>\r\n\r\n        <span ng-show="ssMany" class="fa fa-reply-all selected-clear all" style="cursor:pointer" ng-click="ss_selectAll($event)" title="Selecionar Todos"></span>\r\n\r\n        <div ng-show="isOpen" class="softdown-menu scroll-4" ng-style="{top: dropTopFixed + \'px\', left: dropLeftFixed + \'px\', minWidth: dropWidthFixed + \'px\'}">\r\n\r\n                <ul class="softdown-list" ng-click="$event.stopPropagation()">\r\n\r\n\r\n                </ul>\r\n\r\n            </div>\r\n\r\n    </div>\r\n\r\n</div>\r\n')}]);