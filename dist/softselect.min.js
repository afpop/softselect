!function(){"use strict";angular.module("softselect.directive",[]).directive("softselect",function(s,e){return{restrict:"E",replace:!0,scope:{ssData:"=",ssModel:"=",ssField:"=",ssMany:"<?",ssChange:"=",ssTabindex:"=tabindex",ssDisabled:"="},templateUrl:"softselect.html",compile:function(l,n){return{pre:function(l,n,t){function a(){angular.equals(l.ssModel,void 0)||angular.equals(l.ssModel,[])||angular.equals(l.ssModel,{})?(angular.forEach(l.ssData,function(s){s.selected&&!localStorage.getItem("limparFiltro")||(s.selected=!1)}),l.displayPlaceHolder=!0):l.displayPlaceHolder=!1}function i(){if(a(),angular.isArray(l.ssModel,[]))angular.forEach(l.ssModel,function(s){if(!angular.equals(l.ssData,void 0)){var e=l.ssData.findIndex(function(e){return e[l.ssField.value]===s[l.ssField.value]});l.ssData[e].selected=!0}}),l.ssChange&&l.ssChange(void 0);else if(l.ssModel){if(!angular.equals(l.ssData,void 0)){var s=l.ssData.findIndex(function(s){return s[l.ssField.value]===l.ssModel[l.ssField.value]});angular.equals(l.ssData[s],void 0)||(l.ssData[s].selected=!0),l.ssChange&&l.ssChange(l.ssData[s])}}else l.ssModel={},l.ssChange&&l.ssChange(void 0)}function o(){var e=l.ssData;return(l.ssFilter&&l.ssMany||l.ssModel[l.ssField.text]&&!l.filterControl)&&(e=s("filter")(e,l.ssMany?l.ssFilter:l.ssModel[l.ssField.text],d)),e=s("limitTo")(e,l.selectLimit),e=s("orderBy")(e,l.ssField.orderby)}function d(s,e){if("object"==typeof s&&null!==s&&!angular.isUndefined(s[l.ssField.text])&&null!==s[l.ssField.text])return s=c(s[l.ssField.text]),e=c(e),s.indexOf(e)>-1}function c(s){var e={a:/[\xE0-\xE6]/g,e:/[\xE8-\xEB]/g,i:/[\xEC-\xEF]/g,o:/[\xF2-\xF6]/g,u:/[\xF9-\xFC]/g,c:/\xE7/g,n:/\xF1/g},l=[["Á","A"],["À","A"],["Â","A"],["Ã","A"],["É","E"],["È","E"],["Ê","E"],["Í","I"],["Ì","I"],["Î","I"],["Ó","O"],["Ò","O"],["Ô","O"],["Õ","O"],["Ú","U"],["Ù","U"],["Û","U"]];for(var n in e){var t=e[n];s=s.replace(t,n)}var a;for(a=0;a<l.length;a++)s=s.replace(l[a][0],l[a][1]);return s.toUpperCase()}function r(){angular.forEach(l.ssData,function(s){s.selected=!1}),l.selectedText="",l.ssModel=[],l.displayPlaceHolder=!0}var f=0;l.ssFilter="",l.selectLimit=10,l.ssMany=l.$eval(t.ssMany)||!1,l.lastSelected={},l.getFilteredData=o,l.ss_select=function(s){if(l.selecting=!1,l.displayPlaceHolder=!1,l.ssMany){l.ssModel||(l.ssModel=[]);var n=l.ssModel.some(function(e){return s===e});s.selected&&(n=s.selected),n?(l.ssModel=l.ssModel.filter(function(e){return e.id!==s.id}),s.selected=!1):(s.selected=!0,l.ssModel.push(s)),e(function(){$(u).find(".selected-box").click()},0)}else r(),s.selected=!0,l.ssModel=angular.copy(s);l.ssChange&&l.ssChange(s),a(),l.ssFilter="",o()},l.ss_selectAll=function(){l.displayPlaceHolder=!1,angular.forEach(l.ssData,function(s){s.selected=!0}),l.ssModel=l.ssData},l.ss_clearAll=r,a(),$(".softselect .dropdown").on("click",function(){var s=$(this),e=$(this).find(".dropdown-menu"),n=$(window).height(),t=s.offset().top+s.height()-$(window).scrollTop();t+e.height()>n&&(t-=s.height()+e.height()),e.css("top",t-4),e.css("left",s.offset().left+2),e.css("min-width",s.width()-1),e.toggleClass("open"),s.toggleClass("btn-open"),1==l.ssMany&&$(this).find(".filter").focus(),u=this}),$(window).scroll(function(){var s=$(".softselect .btn-open");if(s.length>0){var e=$(".softselect .btn-open .open"),l=$(this).scrollTop();e.css("top",s.offset().top+s.height()-l)}}),$(".softselect .dropdown .dropdown-menu").scroll(function(){var s=$(this).scrollTop(),e=$(this).prop("scrollHeight")-$(this).outerHeight();e!=f&&s>=e&&l.selectLimit<l.ssData.length&&(l.$apply(function(){l.selectLimit=l.selectLimit+10}),e!=f&&(e=f))}),l.$watch("ssModel",function(){i()}),l.$watch("ssData",function(){i()});var u;l.setFocus=function(s){e(function(){l.ssMany||l.ssModel[l.ssField.text]&&(l.selecting=!0,l.selectedText=l.ssModel[l.ssField.text],l.ssModel[l.ssField.text]="",""!==s.target.value&&s.target.focus(),l.$apply())},200)},l.lostFocus=function(){e(function(){l.selecting&&l.ssModel[l.ssField.text]!==l.selectedText&&(l.ssModel[l.ssField.text]=l.selectedText)},100)},l.cleanFilter=function(){e(function(){l.ssFilter=""},200)}},post:function(s,e,l){}}}}})}(),angular.module("softselect.directive").run(["$templateCache",function(s){s.put("softselect.html",'\n<div class="softselect" ng-class="{\'disabled\': ssDisabled}">\n\n    <div class="dropdown">\n\n            <div tabindex="{{ssTabindex}}"  class="selected-box" placeholder="" aria-describedby="basic-addon2" data-toggle="dropdown" >\n\n                <div class="full-h" ng-hide="ssMany">\n\n                    <div class="form-group has-feedback">\n\n                        <input class="form-control" style="padding-left: 7px !important;" ng-click="setFocus($event)" ng-blur="lostFocus()" ng-model="ssModel[ssField.text]" placeholder="{{ssField.placeholder ? ssField.placeholder : \'Selecionar...\'}}">\n\n                        <span class="fa fa-caret-down form-control-feedback" ng-hide="ssModel[ssField.value]" aria-hidden="true"></span>\n\n                    </div>\n\n                </div>\n\n                <div class="full-h" ng-show="ssMany">\n\n                    <div class="form-group has-feedback">\n\n                        <div class="form-control">\n\n                        <ul style="margin-left: {{ssModel.length > 0 ? \'2px\' : \'7px\'}}">\n\n                            <li ng-show="ssModel.length > 2" class="selected-item" style="max-width: 100px;">\n\n                                <span ng-click="ss_clearAll()"><span class="fa fa-times"></span></span> {{ssModel.length === ssData.length ? "Todos" : ssModel.length}} selecionados\n\n                            </li>\n                            \x3c!--  ng-show="(!displayPlaceHolder && ssModel.length > 0 && ssModel.length <= 2)" --\x3e\n\n                            <li  ng-show="ssModel.length > 0 && ssModel.length <= 2" class="selected-item" ng-repeat="item in ssModel track by $index">\n\n                                <span class="fa fa-times" ng-click="ss_select(item)"></span> {{item[ssField.text]}}\n\n                            </li>\n\n                            <li class="selected-input" style="max-width: {{ssModel.length > 0 ? \'10px\' : \'100%\'}}">\n\n                                <input class="filter" ng-model="ssFilter" ng-blur="cleanFilter()" placeholder="{{ssModel.length > 0 ? \'\' : \'Selecionar...\'}}">\n\n                            </li>&nbsp;\n\n                        </ul>\n\n                    </div>\n\n                        <span class="fa fa-caret-down form-control-feedback" aria-hidden="true"></span>\n\n                    </div>\n\n                </div>\n\n            </div>\n\n            <span class="fa fa-times selected-clear" style="cursor:pointer" ng-show="ssModel[ssField.value]" ng-click="ss_clearAll()"></span>\n\n\n        <div class="dropdown-menu dropdown-menu-left scroll-4">\n\n                <ul>\n\n                    <li class="item" ng-repeat="item in getFilteredData()" ng-click="ss_select(item)">\n\n                        <i class="fa fa-check" ng-show="item.selected" style="color: #2ecc71" ></i> {{item[ssField.text]}}\n\n                    </li>\n\n                </ul>\n\n            </div>\n\n    </div>\n\n</div>\n')}]);