!function(){"use strict";angular.module("softselect.directive",[]).directive("softselect",function(e,s,n,t){return{restrict:"E",replace:!0,scope:{ssData:"=",ssModel:"=",ssField:"=",ssMany:"<?",ssChange:"=",ssTabindex:"=tabindex",ssDisabled:"="},templateUrl:"softselect.html",link:function(s,l,i){function a(){if(angular.isArray(s.ssModel,[]))angular.forEach(s.ssModel,function(e){if(!angular.equals(s.ssData,void 0)){var n=s.ssData.findIndex(function(n){return n[s.ssField.value]===e[s.ssField.value]});s.ssData[n].selected=!0}}),s.ssChange&&s.ssChange(void 0);else if(s.ssModel){if(!angular.equals(s.ssData,void 0)){var e=s.ssData.findIndex(function(e){return e[s.ssField.value]===s.ssModel[s.ssField.value]});angular.equals(s.ssData[e],void 0)||(s.ssData[e].selected=!0),s.ssChange&&s.ssChange(s.ssData[e])}}else s.ssModel={},s.ssChange&&s.ssChange(void 0)}function o(){s.filteredData=s.ssData,(s.ssFilter&&s.ssMany||s.ssModel[s.ssField.text]&&!s.filterControl)&&(s.filteredData=e("filter")(s.ssData,s.ssMany?s.ssFilter:s.ssModel[s.ssField.text],d)),s.filteredData=e("limitTo")(s.filteredData,s.selectLimit),s.filteredData=e("orderBy")(s.filteredData,s.ssField.orderby)}function d(e,n){if("object"==typeof e&&null!==e&&!angular.isUndefined(e[s.ssField.text])&&null!==e[s.ssField.text])return e=r(e[s.ssField.text]),n=r(n),e.indexOf(n)>-1}function r(e){var s={a:/[\xE0-\xE6]/g,e:/[\xE8-\xEB]/g,i:/[\xEC-\xEF]/g,o:/[\xF2-\xF6]/g,u:/[\xF9-\xFC]/g,c:/\xE7/g,n:/\xF1/g},n=[["Á","A"],["À","A"],["Â","A"],["Ã","A"],["É","E"],["È","E"],["Ê","E"],["Í","I"],["Ì","I"],["Î","I"],["Ó","O"],["Ò","O"],["Ô","O"],["Õ","O"],["Ú","U"],["Ù","U"],["Û","U"]];for(var t in s){var l=s[t];e=e.replace(l,t)}var i;for(i=0;i<n.length;i++)e=e.replace(n[i][0],n[i][1]);return e.toUpperCase()}function c(e){angular.forEach(s.ssData,function(e){e.selected=!1}),s.selectedText="",s.ssModel=[],angular.isDefined(e)&&(s.isOpen=!1,s.selecting=!1,e.stopPropagation())}var f=0;s.ssFilter="",s.selectLimit=10,s.ssMany=s.$eval(i.ssMany)||!1,s.lastSelected={},s.isOpen=!1,s.filteredData=[],s.getFilteredData=o,s.ss_select=function(e){if(s.selecting=!0,s.ssMany){s.ssModel||(s.ssModel=[]);var n=s.ssModel.some(function(s){return e===s});e.selected&&(n=e.selected),n?(s.ssModel=s.ssModel.filter(function(s){return s.id!==e.id}),e.selected=!1):(e.selected=!0,s.ssModel.push(e))}else c(),e.selected=!0,s.ssModel=angular.copy(e);s.ssFilter="",o(),s.ssMany&&s.inputFilter.focus()},s.ss_selectAll=function(){angular.forEach(s.ssData,function(e){e.selected=!0}),s.ssModel=s.ssData},s.ss_clearAll=c,s.dropTop=0,s.dropLeft=0,s.dropWidth=0,s.dropHeight=0,s.inputFilter=null,s.open=function(e){var n=e.currentTarget,t=n.querySelector(".softdown-menu");if(s.ssMany?s.inputFilter=n.querySelector(".filter"):s.inputFilter=n.querySelector(".form-control"),function(e,n){var t=$(window).height(),l=$(window).scrollTop(),i=$(e).offset().top,a=$(e).offset().left,o=$(e).height(),d=$(e).width(),r=n.offsetHeight,c=i+o-l;c+r>t&&(c-=o+r),s.dropTopFixed=s.dropTop=c-4,s.dropLeftFixed=s.dropLeft=a+2,s.dropWidthFixed=s.dropWidth=d-2}(n,t),s.isOpen?s.isOpen&&!1===s.ssMany&&(s.isOpen=!1):s.isOpen=!0,!1===s.ssMany){if(!s.ssModel[s.ssField.text])return;s.selectedText=s.ssModel[s.ssField.text],s.selecting?s.selecting=!1:s.ssModel[s.ssField.text]=""}s.ssMany&&s.inputFilter.focus()},s.$watch("ssModel",function(){a()}),s.$watch("ssData",function(){a(),angular.isDefined(s.ssData)&&s.ssData.length>0&&o()}),s.$watch("ssModel[ssField.text]",function(){angular.isDefined(s.ssModel)&&angular.isDefined(s.ssField.text)&&o()}),s.$watch("ssFilter",function(){angular.isDefined(s.ssFilter)&&o()});var p=function(e){s.isOpen&&(l[0].contains(e.target)||s.$apply(function(){s.isOpen&&(s.selecting?s.selecting=!1:(s.isOpen=!1,s.ssModel[s.ssField.text]!==s.selectedText&&(s.ssModel[s.ssField.text]=s.selectedText),!0===s.ssMany&&(s.ssFilter="")))}))};n.on("click",p),s.$on("$destroy",function(){n.off("click",p)}),angular.element(t).bind("scroll",function(){s.isOpen&&(s.dropTopFixed=s.dropTop-this.pageYOffset,s.$apply())}),$(".softselect .softdown .softdown-menu").scroll(function(){var e=$(this).scrollTop(),n=$(this).prop("scrollHeight")-$(this).outerHeight();n!=f&&e>=n&&s.selectLimit<s.ssData.length&&(s.$apply(function(){s.selectLimit=s.selectLimit+10,o()}),n!=f&&(n=f))})}}})}(),angular.module("softselect.directive").run(["$templateCache",function(e){e.put("softselect.html",'\n<div class="softselect" ng-class="{\'disabled\': ssDisabled}">\n\n    <div class="softdown" ng-click="open($event)" ng-keypress="$event.stopPropagation()">\n\n        <div tabindex="{{ssTabindex}}"  class="selected-box" placeholder="" aria-describedby="basic-addon2" >\n\n                <div class="full-h" ng-hide="ssMany">\n\n                    <div class="form-group has-feedback">\n\n                        <input type="text" class="form-control" style="padding-left: 7px !important;" ng-model="ssModel[ssField.text]" placeholder="{{ssField.placeholder ? ssField.placeholder : \'Selecionar...\'}}">\n\n                        <span class="fa fa-caret-down form-control-feedback" ng-hide="ssModel[ssField.value]" aria-hidden="true"></span>\n\n                    </div>\n\n                </div>\n\n                <div class="full-h" ng-show="ssMany">\n\n                    <div class="form-group has-feedback">\n\n                        <div class="form-control">\n\n                        <ul style="margin-left: {{ssModel.length > 0 ? \'2px\' : \'7px\'}}">\n\n                            <li ng-show="ssModel.length > 2" class="selected-item" style="max-width: 100px;">\n\n                                <span ng-click="ss_clearAll($event)"><span class="fa fa-times"></span></span> {{ssModel.length === ssData.length ? "Todos" : ssModel.length}} selecionados\n\n                            </li>\n\n                            <li  ng-show="ssModel.length > 0 && ssModel.length <= 2" class="selected-item" ng-repeat="item in ssModel track by $index">\n\n                                <span class="fa fa-times" ng-click="ss_select(item)"></span> {{item[ssField.text]}}\n\n                            </li>\n\n                            <li class="selected-input" style="margin-left: 2px; max-width: {{ssModel.length > 0 ? \'10px\' : \'100%\'}}">\n\n                                <input class="filter" ng-model="ssFilter" placeholder="{{ssModel.length > 0 ? \'\' : \'Selecionar...\'}}">\n\n                            </li>&nbsp;\n\n                        </ul>\n\n                    </div>\n\n                        <span class="fa fa-caret-down form-control-feedback" aria-hidden="true"></span>\n\n                    </div>\n\n                </div>\n\n            </div>\n\n        <span class="fa fa-times selected-clear" style="cursor:pointer" ng-show="ssModel[ssField.value]" ng-click="ss_clearAll($event)"></span>\n\n        <div ng-show="isOpen" class="softdown-menu scroll-4" ng-style="{top: dropTopFixed + \'px\', left: dropLeftFixed + \'px\', minWidth: dropWidthFixed + \'px\'}">\n\n                <ul>\n\n                    <li class="item" ng-repeat="item in filteredData" ng-click="ss_select(item)">\n\n                        <i class="fa fa-check" ng-show="item.selected" style="color: #2ecc71" ></i> {{item[ssField.text]}}\n\n                    </li>\n\n                </ul>\n\n            </div>\n\n    </div>\n\n</div>\n')}]);